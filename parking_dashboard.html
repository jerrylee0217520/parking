<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>佳元松江社區 一樓停車位即時狀態</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* 自定義滾動條樣式 */
    ::-webkit-scrollbar {
      width: 8px;
    }
    ::-webkit-scrollbar-track {
      background: #f5f6fa;
    }
    ::-webkit-scrollbar-thumb {
      background: #c5d0d8;
      border-radius: 4px;
    }
    
    html, body {
      margin: 0;
      padding: 0;
      /* 柔和的漸層背景 */
      background: linear-gradient(135deg, #f0f4f8, #d9e2ec);
      font-family: 'Noto Sans TC', 'Microsoft JhengHei', sans-serif;
      color: #333;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
      gap: 1rem;
      width: 95%;
      max-width: 1000px;
      margin: 1.5rem auto;
      padding: 1rem;
      background: rgba(255, 255, 255, 0.8);
      border-radius: 20px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.1);
    }

    .spot {
      position: relative;
      padding-top: 100%;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
      transition: all 0.3s ease-in-out;
      cursor: default;
    }
    
    .spot:hover {
        transform: translateY(-5px) scale(1.03);
        box-shadow: 0 6px 20px rgba(0,0,0,0.12);
    }

    .spot-inner {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #fff;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
      padding: 0.5rem;
      text-align: center;
    }
    
    .spot-number {
        font-size: 1.75rem;
        font-weight: bold;
    }

    .available { 
      background: linear-gradient(45deg, #66bb6a, #43a047); 
    }
    
    .occupied { 
      background: linear-gradient(45deg, #ef5350, #d32f2f); 
      animation: occupiedPulse 2.5s infinite ease-in-out;
    }
    
    @keyframes occupiedPulse {
        0%, 100% { box-shadow: 0 4px 15px rgba(239, 83, 80, 0.2); }
        50% { box-shadow: 0 8px 25px rgba(239, 83, 80, 0.4); }
    }

    #refresh {
      display: block;
      margin: 1.5rem auto;
      padding: 0.75rem 1.5rem;
      font-size: 1.1rem;
      background: #2E5540;
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(46,85,64,0.3);
      transition: all 0.3s ease;
    }

    #refresh:active {
        transform: translateY(1px);
        box-shadow: 0 2px 10px rgba(46,85,64,0.4);
    }
    
    .spot.refreshing {
        animation: spotRefresh 0.8s ease-in-out;
    }
    @keyframes spotRefresh {
        0% { transform: scale(1); }
        50% { transform: scale(1.05) rotate(5deg); }
        100% { transform: scale(1) rotate(0deg); }
    }

    .spot-status {
      font-size: 0.8rem;
      font-weight: normal;
      margin-top: 0.25rem;
    }
    .car-info {
        font-size: 1rem;
        font-weight: bold;
        margin-top: 0.25rem;
        line-height: 1.3;
        width: 100%;
    }
  </style>
</head>
<body class="antialiased">
  <div class="container mx-auto p-4">
    <h1 id="dashboardTitle" class="text-3xl font-bold text-center text-gray-800 my-4">佳元松江社區 一樓停車位儀表板</h1>
    <div class="grid" id="parkingGrid"></div>
    <div class="flex flex-col sm:flex-row justify-center mt-4 space-y-2 sm:space-y-0 sm:space-x-4">
        <button id="refresh">刷新停車狀態</button>
    </div>
  </div>
  <script>
    const parkingCsvData = `日期,停放時間,離開時間,車牌號碼,戶別,停車人,停放地點,車位號
114/08/02,12:01:00,,GD8899,3CD-3樓,屋主,一樓外圍,無
2025-08-02,10:49:00,,5989-EY,10B-10樓,屋主梁本郁之母（翁經理）,騎樓入口,B2-05
2025-08-02,12:01:00,,ATD-6886,5D-5樓,屋主本人,一樓外圍,無
2025-08-02,12:25,14:10,EBC-2270,6B-6樓,屋主本人,一樓外圍,B2-06
2025-08-02,12:59,14:18,BFA-0050,5C-5樓,屋主王子嫣的先生(陳伍佰),一樓外圍,B2-14
2025-08-02,15:08,16:48,AXS-5005,7C-7樓,屋主友人,一樓外圍,無`;

    function renderParking() {
      const grid = document.getElementById('parkingGrid');
      
      const spots = document.querySelectorAll('.spot');
      if (spots.length > 0) {
        spots.forEach(spot => spot.classList.add('refreshing'));
      }
      
      setTimeout(() => {
        grid.innerHTML = '';
        
        const lines = parkingCsvData.split(/\r?\n/).filter(line => line.trim() !== '');
        if (lines.length < 2) {
            spots.forEach(spot => spot.classList.remove('refreshing'));
            return;
        }

        const headers = lines[0].split(',').map(h => h.trim());
        const dataRows = lines.slice(1);

        const getIndex = (name) => headers.indexOf(name);
        const dateIndex = getIndex('日期');
        const parkingTimeIndex = getIndex('停放時間');
        const leaveTimeIndex = getIndex('離開時間');
        const carPlateIndex = getIndex('車牌號碼');
        const huBeiIndex = getIndex('戶別');

        if ([dateIndex, parkingTimeIndex, leaveTimeIndex, carPlateIndex, huBeiIndex].includes(-1)) {
          console.error("CSV 文件中缺少一個或多個必要的欄位。");
          grid.innerHTML = `<p class="text-red-500 text-center col-span-full">錯誤：CSV資料格式不符。</p>`;
          return;
        }

        const occupiedCarInfo = dataRows.map(row => row.split(','))
          .map(values => ({
            date: values[dateIndex]?.trim(),
            parkingTime: values[parkingTimeIndex]?.trim(),
            leaveTime: values[leaveTimeIndex]?.trim(),
            carPlate: values[carPlateIndex]?.trim(),
            huBei: values[huBeiIndex]?.trim(),
          }))
          .filter(car => car.parkingTime && !car.leaveTime);

        // 處理日期格式
        const firstDate = dataRows[0].split(',')[dateIndex].trim();
        const formattedDate = firstDate.replace('年', '-').replace('月', '-').replace('日', '');
        document.getElementById('dashboardTitle').textContent = `佳元松江社區 一樓停車位儀表板 (${formattedDate})`;
        
        const occupiedCount = occupiedCarInfo.length;
        for (let i = 1; i <= 7; i++) {
          const id = String(i).padStart(2, '0');
          const isOccupied = i <= occupiedCount;
          
          const spotDiv = document.createElement('div');
          spotDiv.className = `spot ${isOccupied ? 'occupied' : 'available'}`;
          
          const innerDiv = document.createElement('div');
          innerDiv.className = 'spot-inner';
          
          let spotHtml = `<div class="spot-number">${id}</div>`;
          if (isOccupied) {
              const car = occupiedCarInfo[i - 1];
              spotHtml += `<div class="spot-status">已佔用</div>`;
              spotHtml += `<div class="car-info">${car.carPlate}<br>${car.huBei}</div>`;
          } else {
              spotHtml += `<div class="spot-status">可停</div>`;
          }

          innerDiv.innerHTML = spotHtml;
          spotDiv.appendChild(innerDiv);
          grid.appendChild(spotDiv);
        }
        
      }, 500);
    }

    document.getElementById('refresh').addEventListener('click', () => renderParking());
    window.addEventListener('DOMContentLoaded', () => renderParking());
  </script>
</body>
</html>